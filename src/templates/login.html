<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IOC 創作者之島 / 登入</title>

    <script src="https://code.jquery.com/jquery-3.5.1.min.js"
        integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
    <script src="https://www.google.com/recaptcha/api.js" async defer></script>
    <script src="/static/basic.js"></script>
    <script src="/static/sha256.js"></script>

    <style>
        body {
            background: gray;
        }
    </style>
</head>
<body>
    <!-- 6Lfouw0aAAAAAGnQn18bgKnIUemtEAzwYiX0rWIq -->
    <form id="signup" action="javascript:;" onsubmit="return SubmitSignup(this);">
        <input field="login_id" type="text" placeholder="註冊帳號"><br>
        <input field="password" type="password" placeholder="密碼"><br>
        <input field="email" type="text" placeholder="Email"><br>
        <input field="nickname" type="text" placeholder="匿稱"><br>

        <input type="submit" value="註冊">
    </form>

    <br><br><br>

    <form id="login" action="javascript:;" onsubmit="return SubmitLogin(this);">
        <input field="login_id" type="text" placeholder="登入帳號"><br>
        <input field="password" type="password" placeholder="密碼"><br>
    
        <input type="submit" value="登入">
    </form>

    <script>
        function SubmitSignup(formEle) {
            var data = GetFormFieldsData(formEle);

            if (data == null) {
                alert("請填寫完整");
                return;
            }
            else {
                data.password = sha256(data.password);

                Post("/rest/account/signup", data, function (msg) {
                    StoreCookie("key", msg.key);
                    location.pathname = "/";
                }, function (err) {
                    if (err.responseJSON.reason == "Repeated login_id") {
                        alert("帳號重複");
                    }
                });
            }
        }

        function SubmitLogin(formEle) {
            var data = GetFormFieldsData(formEle);

            if (data == null) {
                alert("請填寫完整");
                return;
            }
            else {
                data.password = sha256(data.password);

                Post("/rest/account/login", data, function (msg) {
                    StoreCookie("key", msg.key);
                    location.pathname = "/";
                }, function (err) {
                    if (err.responseJSON.reason == "Field wrong") {
                        alert("帳號密碼錯誤");
                    }
                    else if (err.responseJSON.reason == "Human failed") {
                        alert("人類認證失敗");
                    }
                });
            }
        }

        (function () {
            if (GetCookie("key") != "") {
                location.pathname = "/";
                return;
            }

            var user = {
                login_id: "panmichael",
                password: "panpan",
                email: "panmpan@gmail.com",
                nickname: "Michael",
            };
            FillFormFieldswithData(document.getElementById("signup"), user);
            FillFormFieldswithData(document.getElementById("login"), user);
        })();
    </script>
</body>
</html>